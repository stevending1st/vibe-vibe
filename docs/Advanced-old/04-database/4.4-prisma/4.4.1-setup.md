---
title: "4.4.1 Prisma 安装配置：CLI 工具与依赖管理"
typora-root-url: ../../public
---

# 4.4.1 Prisma 安装配置：CLI 工具与依赖管理

### 一句话破题

安装 Prisma 只需两步：安装依赖 + 初始化配置。

### 安装步骤

**1. 安装依赖**

```bash
# 安装 Prisma CLI（开发依赖）和 Prisma Client（运行时依赖）
npm install prisma --save-dev
npm install @prisma/client
```

| 包名 | 作用 | 环境 |
|------|------|------|
| `prisma` | CLI 工具（迁移、生成等） | 开发 |
| `@prisma/client` | 数据库查询客户端 | 运行时 |

**2. 初始化项目**

```bash
npx prisma init
```

这会创建：
```
project/
├── prisma/
│   └── schema.prisma   # 数据模型定义
└── .env                # 数据库连接配置
```

### schema.prisma 初始内容

```prisma
// 生成器配置：生成 Prisma Client
generator client {
  provider = "prisma-client-js"
}

// 数据源配置：数据库连接
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

### .env 配置

```env
# PostgreSQL 连接字符串
DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public"

# 示例：本地开发
DATABASE_URL="postgresql://postgres:password@localhost:5432/mydb?schema=public"

# 示例：Supabase
DATABASE_URL="postgresql://postgres:[PASSWORD]@db.[PROJECT].supabase.co:5432/postgres"
```

### 常用 CLI 命令

| 命令 | 作用 |
|------|------|
| `npx prisma init` | 初始化 Prisma 项目 |
| `npx prisma generate` | 生成 Prisma Client |
| `npx prisma migrate dev` | 创建并应用迁移 |
| `npx prisma db push` | 推送 Schema 到数据库（无迁移） |
| `npx prisma studio` | 启动可视化数据管理界面 |
| `npx prisma db seed` | 运行种子数据脚本 |

### 开发环境 vs 生产环境

| 场景 | 推荐数据库 | 配置 |
|------|-----------|------|
| **本地开发** | SQLite | 简单、无需安装 |
| **团队开发** | PostgreSQL（Docker） | 保持一致 |
| **生产环境** | PostgreSQL（云服务） | Supabase/Neon |

**开发用 SQLite 配置**：
```prisma
datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}
```

### package.json 脚本配置

```json
{
  "scripts": {
    "db:generate": "prisma generate",
    "db:migrate": "prisma migrate dev",
    "db:push": "prisma db push",
    "db:studio": "prisma studio",
    "db:seed": "prisma db seed",
    "postinstall": "prisma generate"
  },
  "prisma": {
    "seed": "tsx prisma/seed.ts"
  }
}
```

`postinstall` 确保每次 `npm install` 后自动生成 Prisma Client。

### 验证安装

```bash
# 检查 Prisma CLI 版本
npx prisma --version

# 启动 Studio 验证连接
npx prisma studio
```

### 本节小结

- 安装 `prisma`（CLI）和 `@prisma/client`（运行时）
- `npx prisma init` 初始化项目
- 配置 `.env` 中的 `DATABASE_URL`
- 开发用 SQLite，生产用 PostgreSQL
