---
title: "2.1.3 å‰åç«¯ä»£ç å†™ä¸€èµ·ï¼Ÿâ€”â€”RSC æ¸²æŸ“ç­–ç•¥ï¼šæœåŠ¡å™¨ç»„ä»¶ä¸å®¢æˆ·ç«¯ç»„ä»¶"
typora-root-url: ../../public
---

# 2.1.3 å‰åç«¯ä»£ç å†™ä¸€èµ·ï¼Ÿâ€”â€”RSC æ¸²æŸ“ç­–ç•¥

## è®¤çŸ¥é‡æ„

ä¼ ç»Ÿçš„ React åº”ç”¨ä¸­ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚è€Œ React Server Componentsï¼ˆRSCï¼‰æ‰“ç ´äº†è¿™ä¸ªè¾¹ç•Œï¼š

```
ä¼ ç»Ÿ Reactï¼šæ‰€æœ‰ç»„ä»¶ â†’ æ‰“åŒ… â†’ å‘é€åˆ°æµè§ˆå™¨ â†’ æµè§ˆå™¨æ‰§è¡Œ
RSCï¼šæœåŠ¡å™¨ç»„ä»¶åœ¨æœåŠ¡å™¨æ‰§è¡Œ â†’ åªå‘é€æ¸²æŸ“ç»“æœ â†’ å®¢æˆ·ç«¯ç»„ä»¶åœ¨æµè§ˆå™¨æ‰§è¡Œ
```

## æœ¬è´¨è¿˜åŸ

```mermaid
flowchart TB
    subgraph Server["æœåŠ¡å™¨ç«¯"]
        SC["Server Component<br/>å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“<br/>å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨èµ„æº<br/>ä¸ä¼šå‘é€åˆ°å®¢æˆ·ç«¯"]
    end
    
    subgraph Client["å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰"]
        CC["Client Component<br/>å¯ä»¥ä½¿ç”¨ useState/useEffect<br/>å¯ä»¥ç»‘å®šäº‹ä»¶<br/>éœ€è¦å‘é€ JS åˆ°æµè§ˆå™¨"]
    end
    
    subgraph Output["è¾“å‡º"]
        HTML["HTML + æœ€å°åŒ– JS"]
    end
    
    SC --> Output
    CC --> Output
```

## æœåŠ¡å™¨ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶

| ç‰¹æ€§ | Server Component | Client Component |
|------|------------------|------------------|
| **è¿è¡Œç¯å¢ƒ** | æœåŠ¡å™¨ | æµè§ˆå™¨ |
| **è®¿é—®æ•°æ®åº“** | âœ… å¯ä»¥ | âŒ ä¸èƒ½ |
| **ä½¿ç”¨ Hooks** | âŒ ä¸èƒ½ç”¨ useState/useEffect | âœ… å¯ä»¥ |
| **äº‹ä»¶å¤„ç†** | âŒ ä¸èƒ½ onClick | âœ… å¯ä»¥ |
| **æ‰“åŒ…å¤§å°** | ä¸è®¡å…¥ | è®¡å…¥ JS Bundle |
| **é»˜è®¤è¡Œä¸º** | App Router é»˜è®¤ | éœ€è¦ `'use client'` |

## ä½•æ—¶ä½¿ç”¨å“ªç§ç»„ä»¶ï¼Ÿ

```mermaid
flowchart TD
    Start["éœ€è¦åˆ›å»ºç»„ä»¶"] --> Q1{"éœ€è¦äº¤äº’ï¼Ÿ<br/>onClick/onChange"}
    Q1 -->|æ˜¯| CC["Client Component"]
    Q1 -->|å¦| Q2{"éœ€è¦çŠ¶æ€ï¼Ÿ<br/>useState"}
    Q2 -->|æ˜¯| CC
    Q2 -->|å¦| Q3{"éœ€è¦å‰¯ä½œç”¨ï¼Ÿ<br/>useEffect"}
    Q3 -->|æ˜¯| CC
    Q3 -->|å¦| Q4{"éœ€è¦æµè§ˆå™¨ APIï¼Ÿ<br/>window/localStorage"}
    Q4 -->|æ˜¯| CC
    Q4 -->|å¦| SC["Server Component"]
    
    style SC fill:#10b981
    style CC fill:#3b82f6
```

### ç®€å•å£è¯€

- **éœ€è¦ç‚¹å‡»ã€è¾“å…¥ã€åŠ¨ç”»** â†’ Client Component
- **åªæ˜¯å±•ç¤ºæ•°æ®** â†’ Server Component
- **æ‹¿ä¸å‡†** â†’ å…ˆå†™æˆ Server Componentï¼Œéœ€è¦äº¤äº’å†æ”¹

## ä»£ç ç¤ºä¾‹

### Server Componentï¼ˆé»˜è®¤ï¼‰

```typescript
// app/posts/page.tsx
// é»˜è®¤å°±æ˜¯ Server Componentï¼Œä¸éœ€è¦ä»»ä½•å£°æ˜

import { prisma } from '@/lib/prisma'

export default async function PostsPage() {
  // âœ… å¯ä»¥ç›´æ¥è®¿é—®æ•°æ®åº“
  const posts = await prisma.post.findMany()
  
  return (
    <ul>
      {posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

### Client Component

```typescript
// components/like-button.tsx
'use client'  // â† å¿…é¡»åœ¨æ–‡ä»¶é¡¶éƒ¨å£°æ˜

import { useState } from 'react'

export function LikeButton({ postId }: { postId: string }) {
  // âœ… å¯ä»¥ä½¿ç”¨ useState
  const [liked, setLiked] = useState(false)
  
  // âœ… å¯ä»¥ç»‘å®šäº‹ä»¶
  return (
    <button onClick={() => setLiked(!liked)}>
      {liked ? 'â¤ï¸' : 'ğŸ¤'}
    </button>
  )
}
```

### æ··åˆä½¿ç”¨

```typescript
// app/posts/[id]/page.tsx - Server Component
import { prisma } from '@/lib/prisma'
import { LikeButton } from '@/components/like-button'

export default async function PostPage({ 
  params 
}: { 
  params: { id: string } 
}) {
  // æœåŠ¡å™¨ç«¯è·å–æ•°æ®
  const post = await prisma.post.findUnique({
    where: { id: params.id }
  })
  
  return (
    <article>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
      {/* å®¢æˆ·ç«¯ç»„ä»¶åµŒå…¥æœåŠ¡å™¨ç»„ä»¶ */}
      <LikeButton postId={post.id} />
    </article>
  )
}
```

## ç»„ä»¶è¾¹ç•Œè§„åˆ™

```mermaid
flowchart TB
    subgraph Valid["âœ… åˆæ³•çš„ç»„åˆ"]
        SC1["Server Component"] --> CC1["Client Component"]
        SC2["Server Component"] --> SC3["Server Component"]
        CC2["Client Component"] --> CC3["Client Component"]
    end
    
    subgraph Invalid["âŒ ä¸åˆæ³•"]
        CC4["Client Component"] -.->|ä¸èƒ½ç›´æ¥å¯¼å…¥| SC4["Server Component"]
    end
```

### å…³é”®è§„åˆ™

1. **Server â†’ Client**ï¼šâœ… æœåŠ¡å™¨ç»„ä»¶å¯ä»¥å¯¼å…¥å®¢æˆ·ç«¯ç»„ä»¶
2. **Server â†’ Server**ï¼šâœ… æœåŠ¡å™¨ç»„ä»¶å¯ä»¥å¯¼å…¥æœåŠ¡å™¨ç»„ä»¶
3. **Client â†’ Client**ï¼šâœ… å®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥å¯¼å…¥å®¢æˆ·ç«¯ç»„ä»¶
4. **Client â†’ Server**ï¼šâŒ å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½ç›´æ¥å¯¼å…¥æœåŠ¡å™¨ç»„ä»¶

### å¦‚æœå®¢æˆ·ç«¯ç»„ä»¶éœ€è¦åŒ…å«æœåŠ¡å™¨ç»„ä»¶ï¼Ÿ

ä½¿ç”¨ `children` æ¨¡å¼ï¼š

```typescript
// âœ… æ­£ç¡®åšæ³•
// client-wrapper.tsx
'use client'
export function ClientWrapper({ children }: { children: React.ReactNode }) {
  return <div onClick={() => {}}>{children}</div>
}

// page.tsx (Server Component)
import { ClientWrapper } from './client-wrapper'
import { ServerComponent } from './server-component'

export default function Page() {
  return (
    <ClientWrapper>
      <ServerComponent />  {/* é€šè¿‡ children ä¼ å…¥ */}
    </ClientWrapper>
  )
}
```

## è§‰çŸ¥ï¼šReview AI ä»£ç æ—¶çš„æ£€æŸ¥ç‚¹

### 1. `'use client'` ä½ç½®

```typescript
// âŒ é”™è¯¯ï¼šä¸åœ¨æ–‡ä»¶é¡¶éƒ¨
import { useState } from 'react'
'use client'  // è¿™æ ·æ— æ•ˆ

// âœ… æ­£ç¡®ï¼šå¿…é¡»åœ¨æœ€é¡¶éƒ¨
'use client'
import { useState } from 'react'
```

### 2. æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨äº†å®¢æˆ·ç«¯ API

```typescript
// âŒ AI å¯èƒ½ç”Ÿæˆè¿™æ ·çš„ä»£ç 
export default function Page() {
  const [data, setData] = useState()  // æœåŠ¡å™¨ç»„ä»¶ä¸èƒ½ç”¨ useState
  
  useEffect(() => {  // æœåŠ¡å™¨ç»„ä»¶ä¸èƒ½ç”¨ useEffect
    // ...
  }, [])
}
```

### 3. æ•°æ®è·å–ä½ç½®

```typescript
// âŒ åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è·å–ï¼ˆä¸å¿…è¦çš„ï¼‰
'use client'
export function PostList() {
  const [posts, setPosts] = useState([])
  useEffect(() => {
    fetch('/api/posts').then(...)  // å¤šä¸€æ¬¡ç½‘ç»œè¯·æ±‚
  }, [])
}

// âœ… åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ç›´æ¥è·å–
export default async function PostList() {
  const posts = await prisma.post.findMany()  // ç›´æ¥è®¿é—®æ•°æ®åº“
  return <ul>...</ul>
}
```

## æœ¬èŠ‚å°ç»“

RSC çš„æ ¸å¿ƒä»·å€¼ï¼š**åœ¨æ­£ç¡®çš„åœ°æ–¹è¿è¡Œæ­£ç¡®çš„ä»£ç **ã€‚

| åœºæ™¯ | é€‰æ‹© | åŸå›  |
|------|------|------|
| æ•°æ®å±•ç¤º | Server Component | å‡å°‘ JS Bundleï¼Œç›´æ¥è®¿é—®æ•°æ® |
| è¡¨å•äº¤äº’ | Client Component | éœ€è¦çŠ¶æ€å’Œäº‹ä»¶ |
| é™æ€ UI | Server Component | é›¶å®¢æˆ·ç«¯ JS |
| åŠ¨ç”»æ•ˆæœ | Client Component | éœ€è¦æµè§ˆå™¨ API |
