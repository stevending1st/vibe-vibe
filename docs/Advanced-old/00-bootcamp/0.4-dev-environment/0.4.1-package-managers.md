---
title: "0.4.1 工具箱该选哪一个——包管理器选择：npm vs pnpm vs yarn"
typora-root-url: ../../public
---

# 0.4.1 工具箱该选哪一个——包管理器选择：npm vs pnpm vs yarn

## 原理与本质：它们到底在做什么

包管理器的本质是三件事：**解析依赖树**、**下载并缓存包**、**把依赖链接到项目的 `node_modules`**。差异在于“如何存储”和“如何链接”。

## 性能与磁盘空间对比（工程视角）

```mermaid
flowchart TB
    subgraph sgnpm ["npm"]
        NCache["每项目独立缓存"];
        NLink["扁平安装, 容易重复"];
    end
    subgraph sgpnpm ["pnpm"]
        PStore["全局内容寻址存储 (store)"];
        PLink["硬链接/符号链接, 复用依赖"];
    end
    subgraph sgyarn ["yarn"]
        YClassic["经典模式, 类似 npm"];
        YBerry["Plug'n'Play, 无 node_modules"];
    end
    NCache --> NLink
    PStore --> PLink
    YClassic --> YBerry
```

- `pnpm`：通过**全局内容寻址存储**复用依赖，磁盘占用更低，安装更快，锁文件更稳定。
- `yarn berry`：Plug'n'Play 模式不生成 `node_modules`，启动速度快，但生态适配需要额外注意。
- `npm`：默认行为直观，生态支持最好，但容易造成重复下载与磁盘膨胀。

## SemVer 语义化版本与版本范围

- 语义化版本：`主.次.修订`（`major.minor.patch`）。
- 版本范围：
  - `^1.2.3`：允许更新到 `<2.0.0`（保留主版本，升级次/修订）。
  - `~1.2.3`：允许更新到 `<1.3.0`（保留主/次版本，升级修订）。
  - 精确锁定：`1.2.3`。

## 破坏性更新识别与应对

- 识别：`major` 版本变更通常意味着不兼容，查看 Release Notes 与 Changelog。
- 应对：
  - 关键依赖使用谨慎范围（敏感场景用 `~` 或固定版本）。
  - 升级前跑测试与构建，观察 `npm outdated`/`pnpm outdated`。
  - 锁文件统一并审查差异，避免团队成员锁文件漂移。

## Windows PowerShell 常用命令

- `npm`：
  - `npm config get registry`
  - `npm config set registry https://registry.npmmirror.com`
  - `npm cache clean --force`
- `pnpm`：
  - `pnpm config set registry https://registry.npmmirror.com`
  - `pnpm store path`
  - `pnpm store prune`
- `yarn`：
  - `yarn config get registry`
  - `yarn config set registry https://registry.npmmirror.com`

## AI 协作指南

- 核心意图：让 AI 帮你“选择并迁移包管理器”，并输出**可执行命令**与**风险提示**。
- 需求定义公式：
  - “将项目从 `npm` 迁移到 `pnpm`，请输出清理缓存、重建锁文件、验证安装速度与磁盘占用的命令清单。”
- 关键术语：`registry`, `lockfile`, `store`, `Plug'n'Play`, `outdated`。

## 决策建议

- 新项目优先选择 `pnpm`（性能与磁盘占用优秀）。
- 需要 PnP 或对 `node_modules` 有强诉求的项目考虑 `yarn berry`。
- 生态兼容和团队习惯优先时，选择 `pnpm` 并规范版本范围与缓存策略。
