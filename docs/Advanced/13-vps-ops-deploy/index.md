---
title: "第十三章：云服务器运维与项目部署"
---

# 第十三章：云服务器运维与项目部署
## 序言
假如你囊中不羞涩，真的去买了一台服务器；或者你发现某云厂商的福利活动，可以领取试用机。

在选择服务器地区时，老师傅建议最好选择 **中国香港** 或海外节点。 原因很简单：国内大陆节点的服务器绑域名必须备案，而香港节点**免备案**，能让你省去数周的等待时间，即买即用。

总之，你获得了一个公网 IP、用户名（通常是 `root`）和密码。 你发现服务器不像 Windows 那样有远程桌面，只能通过**终端 (Terminal)** 操作。你学会了使用 SSH 命令连接服务器： `ssh root@1.2.3.4`

拿到服务器后，老师傅并没有让你直接开始敲代码，而是先教了你几条**服务器初始化的铁律**（比如更新系统、设置防火墙等）。

为了降低运维难度，老师傅推荐你安装 **1Panel** 面板。 这是一个现代化的 Linux 服务器运维管理面板。你按照官方文档的一行命令学会了安装，并且在面板里一键开启了 **Docker**，并顺手配置了**镜像加速**（这在国内网络环境下至关重要）。

**什么是 Docker？** 1Panel 的核心其实就是 Docker。虽然这听起来又是一个新名词，但你可以把它理解为集装箱。

- **隔离性**：每一个应用（你的网站、数据库）都被打包在一个独立的集装箱里运行，互不干扰，也不污染你的服务器系统。
- **一致性**：你在面板里点的每一次安装应用，本质上就是在拉取和运行这些 Docker 集装箱。

这种隔离机制让你明白了一个铁律：**永远不要直接在服务器上写代码或修改文件**。 服务器是用来“跑”代码的**生产环境 (Production)**，而写代码、调试 Bug 应该永远在你的本地电脑的**开发环境 (Development)** 里完成，然后通过 Git 同步上去。

当你兴奋地输入 1Panel 给出的 `http://IP:端口` 访问面板时，浏览器却转圈圈直到超时。 你以为是面板配置错了，但老师傅告诉你，云服务器通常有**第一道安全门——云厂商的安全组**。

安全组相当于云厂商在机房门口设的**防火墙**。 默认情况下，除了 SSH (22) 等少数端口，其他端口都是封死的。你必须去云厂商的控制台后台，手动**开放安全组规则**（放行 1Panel 的端口），外面的请求才能摸到你的服务器边缘。



如果是 Vercel 部署，我们用了云端的 Supabase。但既然有了自己的服务器，完全可以自己部署数据库。

你打开 1Panel 的“应用商店”，一键安装了 **PostgreSQL**。 在安装过程中，你设置了**数据库端口**、**管理员账户**（通常是 `postgres`）和**密码**。

安装完成后，你在面板的“数据库”页面中新建了一个**具体的数据库**（比如 `my_app_db`）。 这里老师傅给你科普了一个常识：**数据库软件 (DBMS) vs 数据库 (Database)**。

- **DBMS (PostgreSQL)**：就像是 Excel 软件本身。
- **Database**：就像是 Excel 打开的一个个 `.xlsx` 文件。 安装一次 PostgreSQL 软件，可以创建无数个独立的数据库文件供不同的项目使用。

在数据库的“连接信息”里，你看到了两个主机名。老师傅告诉你，这决定了你怎么填 `.env` 里的 `DATABASE_URL`：

- **场景一：Node 项目通过 1Panel "运行环境" 启动（推荐）** 此时你的项目运行在 Docker 容器里，数据库也在 Docker 容器里。它们互为邻居。 你应该填写 **Docker 容器名**（例如 `postgresql` 或 `1panel-postgres-x`），而不是 `localhost`。这就好比在局域网里喊邻居的名字。
- **场景二：在服务器终端手动调试** 如果你 SSH 进服务器，在命令行里运行脚本。此时你是站在服务器主机上（Host）去访问容器。 你应该填写 **`127.0.0.1` 或者`localhost` **。因为数据库容器的端口映射到了主机的 localhost 上。



老师傅告诉你，可以直接通过面板的运行环境功能快速部署 Node.js 项目。 你发现这上面的填空题——选择 node 版本、构建命令、环境变量等——竟然跟之前在 Vercel 上做的一模一样。 唯一的区别是：服务器需要先从 GitHub 拉取代码，然后你要配置端口映射并允许端口外部访问。

你之前很疑惑，为什么你的服务器只有一个公网 IP，却可以同时运行好几个都在内部监听 3000 端口的项目？ 原来，Docker 为每个容器提供了**隔离的网络环境**。

- 你的应用 A 在容器里监听 3000。
- 你的应用 B 在容器里监听 3000。 它们互不冲突。

当你部署时，通过**端口映射**技术：

- 把服务器的 **3001** 端口 -> 映射到 应用 A 的 3000。
- 把服务器的 **3002** 端口 -> 映射到 应用 B 的 3000。

这样，外部用户访问 `IP:3001` 和 `IP:3002` 时，流量会被准确地转发给对应的容器。这就解决了端口冲突的问题，让一台服务器能同时跑多个应用。

你通过 `http://IP:端口` 成功访问到了服务器上的应用，但在面板绑定域名后却打不开。 原来是没有做 **DNS 解析**。你熟练地去域名服务商那里添加了一条 **A 记录**，指向服务器的公网 IP。

访问成功了，但浏览器显示一个巨大的“不安全”红色标志。 老师傅告诉你需要申请 SSL 证书。于是你在面板的网站-证书设置里，**一键申请了免费证书**，并开启了 **HTTPS**。 看着地址栏的小绿锁，你终于完成了一次真正的全栈独立部署。



